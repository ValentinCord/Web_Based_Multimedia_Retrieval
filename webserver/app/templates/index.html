<!doctype html>
<html onmousemove="google&&google.fade&&google.fade(event)">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Web MIR</title>
    <link rel="stylesheet" href="static/style.css"> 

    <script>
        window.google = {
            kEI: "",
            kEXPI: "",
            kCSI: {
                e: "",
                ei: "",
                expi: ""
            },
            ml: function () {},
            kHL: "en",
            time: function () {
                return (new Date).getTime()
            },
            log: function (b, d, c) {
                var a = new Image,
                    e = google,
                    g = e.lc,
                    f = e.li;
                a.onerror = (a.onload = (a.onabort = function () {
                    delete g[f]
                }));
                g[f] = a;
                c = c || "/gen_204?atyp=i&ct=" + b + "&cad=" + d + "&zx=" + google.time();
                a.src = c;
                e.li = f + 1
            },
            lc: [],
            li: 0,
            Toolbelt: {}
        };
        window.google.sn = "webhp";
        window.google.timers = {
            load: {
                t: {
                    start: (new Date).getTime()
                }
            }
        };
        try {
            window.google.pt = window.chrome && window.chrome.csi && Math.floor(window.chrome.csi().pageT);
        } catch (u) {}
        window.google.jsrt_kill = 1;
        var _gjwl = location;
  
        function _gjuc() {
            var b = _gjwl.href.indexOf("#");
            if (b >= 0) {
                var a = _gjwl.href.substring(b + 1);
                if (/(^|&)q=/.test(a) && a.indexOf("#") == -1 && !/(^|&)cad=h($|&)/.test(a)) {
                    _gjwl.replace("/search?" + a.replace(/(^|&)fp=[^&]*/g, "") + "&cad=h");
                    return 1
                }
            }
            return 0
        }
        function _gjp() {
            !(window._gjwl.hash && window._gjuc()) && setTimeout(_gjp, 500)
        };
        window._gjp && _gjp()
      </script>
    
    <script>
      google.y = {};
      google.x = function (e, g) {
          google.y[e.id] = [e, g];
          return false
      };
      if (!window.google) window.google = {};
      window.google.crm = {};
      window.google.cri = 0;
      window.clk = function (e, f, g, k, l, b, m) {
          if (document.images) {
              var a = encodeURIComponent || escape,
                  c = new Image,
                  h = window.google.cri++;
              window.google.crm[h] = c;
              c.onerror = (c.onload = (c.onabort = function () {
                  delete window.google.crm[h]
              }));
              if (b && b.substring(0, 6) != "&sig2=") b = "&sig2=" + b;
              c.src = ["/url?sa=T", "", f ? "&oi=" + a(f) : "", g ? "&cad=" + a(g) : "", "&ct=", a(k || "res"), "&cd=", a(l), "&ved=", a(m), e ? "&url=" + a(e.replace(/#.*/, "")).replace(/\+/g, "%2B") : "", "&ei=", "Ppf3S55bm578BsjS1a4K", b].join("")
          }
          return true
      };
      window.gbar = {
          qs: function () {},
          tg: function (e) {
              var o = {
                  id: 'gbar'
              };
              for (i in e) o[i] = e[i];
              google.x(o, function () {
                  gbar.tg(o)
              })
          }
      };
    </script>

  </head>

  <body>

    <header>
        <img class = nav_logo src = "static/logo.png" alt = "logo">
        <nav>
            <ul class= nav_links>
                <li><a href='{{ url_for('main') }}'>Search</a></li>
                <li><a href='{{ url_for('history') }}'>History</a></li>
                <li><a href='{{ url_for('help') }}'>Help</a></li>
                <li><a href='{{ url_for('logout') }}'>Log out</a></li>
            </ul>
        </nav>
    </header>

    <!-- Header for Pacman Game -->
    <div id = game_header>
      <div id = game>
        <div id=logo>
          <div id=logo-l>
            <div id=logo-b></div>
          </div>
        </div>
        <script>
          google.pml = function () {
              function d(a) {
                  if (!google.pml_installed) {
                      google.pml_installed = true;
                      if (!a) {
                          document.getElementById("logo").style.background = "black";
                          window.setTimeout(function () {
                              var b = document.getElementById("logo-l");
                              if (b) b.style.display = "block"
                          }, 400)
                      }
                      a = document.createElement("script");
                      a.type = "text/javascript";
                      a.src = "../static/pacman.js";
                      google.dom.append(a)
                  }
              }
              function e() {
                  if (document.f && document.f.btnI) document.f.btnI.onclick = function () {
                      if (typeof google.pacman != "undefined") google.pacman.insertCoin();
                      else {
                          google.pacManSound = true;
                          d(false)
                      }
                      return false
                  }
              }
              if (!google.pml_loaded) {
                  google.pml_loaded = true;
                  window.setTimeout(function () {
                      document.f && document.f.q && document.f.q.value == "" && d(true)
                  }, 1E4);
                  e();
                  google.rein && google.rein.push(e);
                  google.dstr && google.dstr.push(function () {
                      google.pacman && google.pacman.destroy();
                      if (google.pml_installed) {
                          for (var a = (document.getElementById("xjsc") || document.body).getElementsByTagName("script"), b = 0, c; c = a[b++];) c.src.indexOf("/logos/js") != -1 && google.dom.remove(c);
                          google.pml_installed = false
                      }
                  });
                  google.pacManQuery = function () {
                      google.nav(document.getElementById("dlink").href)
                  }
              }
          };
        </script>
      </div>
      <form action="" name=f>
        <div id = insert_coin_div>
          <input name = btnI type = submit value = "Insert One or Two Coins" id = insert_coin>
        </div>
      </form>
      <div id=xjsi>
        <script>
          if (google.y) google.y.first = [];
          if (google.y) google.y.first = [];
          google.dstr = [];
          google.rein = [];
          window.setTimeout(function () {
              var a = document.createElement("script");
              a.src = "../static/google-script.js";
              (document.getElementById("xjsd") || document.body).appendChild(a);
              if (google.timers && google.timers.load.t) google.timers.load.t.xjsls = (new Date).getTime();
          }, 0);;
          google.neegg = 1;
          google.y.first.push(function () {
              google.ac.i(document.f, document.f.q, '', '', '', {
                  o: 1,
                  sw: 1
              });
              (function () {
                  var h, i, j = 1,
                      k = google.time(),
                      l = [];

                  function m(a, f) {
                      var b = [];
                      for (var c = 0, e; e = a[c++];) {
                          var d = document.getElementById(e);
                          d && b.push(d)
                      }
                      for (var c = 0, g; g = f[c++];) b = b.concat(n(g[0], g[1]));
                      for (var c = 0; b[c]; c++) b[c] = [b[c], "opacity", 0, 1, 0, ""];
                      return b
                  }
                  function n(a, f) {
                      var b = [],
                          c = new RegExp("(^|\\s)" + f + "($|\\s)");
                      for (var e = 0, d, g = document.getElementsByTagName(a); d =
                      g[e++];) c.test(d.className) && b.push(d);
                      return b
                  }
                  google.fade = function (a) {
                      if (google.fx && j) {
                          a = a || window.event;
                          var f = 1,
                              b = google.time() - k;
                          if (a && a.type == "mousemove") {
                              var c = a.clientX,
                                  e = a.clientY;
                              f = (h || i) && (h != c || i != e) && b > 600;
                              h = c;
                              i = e
                          }
                          if (f) {
                              j = 0;
                              google.fx.animate(600, m(["fctr", "ghead", "pmocntr", "sbl", "tba", "tbe"], [
                                  ["span", "fade"],
                                  ["div", "fade"],
                                  ["div", "gbh"]
                              ]));
                              for (var d = 0; d < l.length; ++d) if (typeof l[d] == "function") l[d]()
                          }
                      }
                  };
                  google.addFadeNotifier = function (a) {
                      l.push(a);
                      if (!j) a()
                  };
              })();;
              google.History && google.History.initialize('/webhp?hl\x3den')
          });
          if (google.j && google.j.en && google.j.xi) {
              window.setTimeout(google.j.xi, 0);
              google.fade = null;
          }
          google.pml && google.pml();
        </script>
      </div>    
      <script>
        (function () {
            var b, d, e, f;

            function g(a, c) {
                if (a.removeEventListener) {
                    a.removeEventListener("load", c, false);
                    a.removeEventListener("error", c, false)
                } else {
                    a.detachEvent("onload", c);
                    a.detachEvent("onerror", c)
                }
            }
            function h(a) {
                f = (new Date).getTime();
                ++d;
                a = a || window.event;
                var c = a.target || a.srcElement;
                g(c, h)
            }
            var i = document.getElementsByTagName("img");
            b = i.length;
            d = 0;
            for (var j = 0, k; j < b; ++j) {
                k = i[j];
                if (k.complete || typeof k.src != "string" || !k.src)++d;
                else if (k.addEventListener) {
                    k.addEventListener("load", h, false);
                    k.addEventListener("error", h, false)
                } else {
                    k.attachEvent("onload", h);
                    k.attachEvent("onerror", h)
                }
            }
            e = b - d;

            function l() {
                google.timers.load.t.ol = (new Date).getTime();
                google.timers.load.t.iml = f;
                google.kCSI.imc = d;
                google.kCSI.imn = b;
                google.kCSI.imp = e;
                google.report && google.report(google.timers.load, google.kCSI)
            }
            if (window.addEventListener) window.addEventListener("load", l, false);
            else if (window.attachEvent) window.attachEvent("onload", l);
            google.timers.load.t.prt = (f = (new Date).getTime());
        })();
      
        (function () {
            var b, d, e, f;

            function g(a, c) {
                if (a.removeEventListener) {
                    a.removeEventListener("load", c, false);
                    a.removeEventListener("error", c, false)
                } else {
                    a.detachEvent("onload", c);
                    a.detachEvent("onerror", c)
                }
            }
            function h(a) {
                f = (new Date).getTime();
                ++d;
                a = a || window.event;
                var c = a.target || a.srcElement;
                g(c, h)
            }
            var i = document.getElementsByTagName("img");
            b = i.length;
            d = 0;
            for (var j = 0, k; j < b; ++j) {
                k = i[j];
                if (k.complete || typeof k.src != "string" || !k.src)++d;
                else if (k.addEventListener) {
                    k.addEventListener("load", h, false);
                    k.addEventListener("error", h, false)
                } else {
                    k.attachEvent("onload", h);
                    k.attachEvent("onerror", h)
                }
            }
            e = b - d;

            function l() {
                google.timers.load.t.ol = (new Date).getTime();
                google.timers.load.t.iml = f;
                google.kCSI.imc = d;
                google.kCSI.imn = b;
                google.kCSI.imp = e;
                google.report && google.report(google.timers.load, google.kCSI)
            }
            if (window.addEventListener) window.addEventListener("load", l, false);
            else if (window.attachEvent) window.attachEvent("onload", l);
            google.timers.load.t.prt = (f = (new Date).getTime());
        })();
      </script>
    </div>

    <!-- Search Engine-->
    <div id = search>

        <!-- Column 1-->
        <div id = c1>
            <h1>Configuration</h1>

            <form method="POST" action='/'>
                <h2>I. Select descriptors</h2>
                <div id = desc>
                    <div class = desc-item>
                        <h3>Color</h3>
                        <div><input type="checkbox" name="BGR"/><label>BGR</label></div>
                        <div><input type="checkbox" name="HSV" /><label>HSV</label></div>
                    </div>
                    <div class = desc-item>
                        <h3>Shape</h3>
                        <div><input type="checkbox" name="SIFT"/><label>SIFT</label></div>
                        <div><input type="checkbox" name="GLCM"/><label>GLCM</label></div>
                    </div>
                    <div class = desc-item>
                        <h3>texture</h3>
                        <div><input type="checkbox" name="HOG" /><label>HOG</label></div>
                        <div><input type="checkbox" name="LBP" /><label>LBP</label></div>
                        <div><input type="checkbox" name="ORB" /><label>ORB</label></div>
                    </div>
                    <div class = desc-item>
                        <h3>Deep Learning</h3>
                        <div><input type="checkbox" name="VGG16_false" /><label>VGG16</label></div>
                        <div><input type="checkbox" name="XCEPTION_true" /><label>LastXception</label></div>
                        <div><input type="checkbox" name="XCEPTION_false" /><label>Xception</label></div>
                        <div><input type="checkbox" name="MOBILENET_false" /><label>MobileNet</label></div>
                    </div>
                    <div class = desc-item>
                        <h3>DL PCA</h3>
                        <div><input type="checkbox" name="VGG16_false_pca" /><label>VGG16</label></div>
                        <div><input type="checkbox" name="XCEPTION_true_pca" /><label>LastXception</label></div>
                        <div><input type="checkbox" name="XCEPTION_false_pca" /><label>Xception</label></div>
                        <div><input type="checkbox" name="MOBILENET_false_pca" /><label>MobileNet</label></div>
                    </div>
                    <div class = desc-item>
                        <h3>DL RMAC</h3>
                        <div><input type="checkbox" name="VGG16_false_rmac" /><label>VGG16</label></div>
                        <div><input type="checkbox" name="XCEPTION_true_rmac" /><label>LastXception</label></div>
                        <div><input type="checkbox" name="XCEPTION_false_rmac" /><label>Xception</label></div>
                        <div><input type="checkbox" name="MOBILENET_false_rmac" /><label>MobileNet</label></div>
                    </div>
                    <input class = retro_btn type="submit" name = 'form_desc' value="Submit"/>
                </div>
            </form>

            <form method="POST"  action='/'>
                <h2>II. Select distance</h2>
                <div id = dist>
                    <select class = small_select name="distance_vect" >
                        <option disabled selected value> Vector distance</option>
                        <option value = 'euclidean'>Euclidean</option>
                        <option value = 'correlation'>Correlation</option>
                        <option value = 'interesection'>Intersection</option>
                        <option value = 'chiSquareDistance'>Chi-square</option>
                        <option value = 'bhatta'>Bhattcharyya</option>
                    </select> 
                    <select class = small_select name="distance_matrix" >
                        <option disabled selected value> Matrix distance </option>
                        <option value = 'bruteForceMatching'>Brute Force Matcher</option>
                        <option value = 'flann'>Flann</option>
                    </select>
                    <input class = retro_btn type="submit" name = 'form_dist' value="Submit"/>
                </div>
            </form>
        
            <h2>III. Select input image</h2>
            <form method= "POST" enctype=multipart/form-data  action='/'>
                <div id = inputfile>
                    <input class = input_size type=file name=file>
                    <input class = retro_btn type=submit name='form_input_image' value="Submit">
                </div>
            </form>
            
            <form method = 'POST' action='/'><input type = submit name = 'form_search' class = 'retro_btn large'value = 'Indexation'></form>

        </div>

        <!-- Column 2-->
        <div id = c2>
            
            {% if get_flashed_messages() %}
                <h1 class = ko>Warning</h1>
                <div>{% for mesg in get_flashed_messages() %}<h3>{{ mesg }}</h3>{% endfor %}</div>
            {% endif %}


            <h1>Summary</h1>
            
            {% if cfg['descriptors']['is_selected'] %}
                <h3>Descriptors</h3>
                {% for k,v in cfg['descriptors'].items() %}
                    {% if v == True and k != 'is_selected' %}
                        {{ k }}<br>
                    {% endif %}
                {% endfor %}
            {% endif %}

            {% if cfg['distance']['is_selected'] %}
                <h3>Distance</h3>
                vector : {{ cfg['distance']['vect'] }} <br>
                matrix : {{ cfg['distance']['matrix'] }}
            {% endif %}

            {% if cfg['input']['is_selected'] %}
                <h3>Input</h3>
                <img src = {{ cfg['input']['img_path'] }} height = 200px > 
            {% endif %}

            {% if cfg['result']['done'] %}
                <h3>Indexation and Search time</h3>
                {{ cfg['result']['time'] }} seconds
            {% endif %}

            
        </div>
    </div>

    <!-- Show -->
    <br>
    <br>
    {% if cfg['result']['done']%}
    <div id = show>
        <form method = 'POST' action='/'><input type = submit class = retro_btn name = 'form_top_20' value = 'Show top-20'></form>
        <form method = 'POST' action='/'><input type = submit class = retro_btn name = 'form_top_50' value = 'Show top-50'></form>
        <form method = 'POST' action='/'><input type = submit class = retro_btn name = 'form_rp'     value = 'Show metrics'></form>
    </div>
    {% endif %}
    <br>
    <br>

    <!-- Results -->
    <div id = 'result'>
        <div class = 'grid'>

        {% if cfg['show']['20'] %}
            {% for v in cfg['result']['names'][:20] %}
                <div class = box_item>
                    <h3>Score : {{ v[1] }}</h3>
                    <img class = 'item' src = {{ v[0] }}>
                </div>
            {% endfor %}

        {% elif cfg['show']['50'] %}
            {% for v in cfg['result']['names'][:50] %}
            <div class = box_item>
                <h3>Score : {{ v[1] }}</h3>
                <img class = 'item' src = {{ v[0] }}>
            </div>            
        {% endfor %}

        {% elif cfg['show']['rp'] %}
            {% if cfg['input']['is_in_database'] %}
                <img class = 'item_curve' src = 'static/rp_class.png'>
                <img class = 'item_curve' src = 'static/rp_subclass.png'>

                <table class = metrics_table>
                    <tr> 
                        <th>Classe AP(20)</th>
                        <th>Classe AP(50)</th> 
                        <th>Classe r-Precision</th>
                        <th>SubClasse AP(20)</th>
                        <th>SubClasse AP(50)</th> 
                        <th>SubClasse r-Precision</th>
                    </tr>
                    <tr> 
                        <td>{{ cfg['metrics']['classe']['ap-20'] }}</td>
                        <td>{{ cfg['metrics']['classe']['ap-50'] }}</td> 
                        <td>{{ cfg['metrics']['classe']['r-precision'] }}</td> 
                        <td>{{ cfg['metrics']['subclasse']['ap-20'] }}</td>
                        <td>{{ cfg['metrics']['subclasse']['ap-50'] }}</td> 
                        <td>{{ cfg['metrics']['subclasse']['r-precision'] }}</td> 
                    </tr>
                  </table>

            {% else %}
                  <h3 class="no_metric">No metrics to show</h3>
            {% endif %}
        {% endif %}
        </div>
        <br>
        <br>
    </div>

  </body>
</html>
    
  
